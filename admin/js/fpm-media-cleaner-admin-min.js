!function($){"use strict";function e(e){let t,n,r,o,a;return t=e.getHours(),n=e.getMinutes(),r=e.getDate(),o=e.getMonth()+1,a=e.getFullYear(),t=t.toString().padStart(2,"0"),n=n.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),o=o.toString().padStart(2,"0"),`${t}:${n} ${r}.${o}.${a}`}function t(e,t){return $.post(ajaxurl,{action:e,...t}).pipe((function(e){try{return JSON.parse(e)}catch(t){return function(e,t="log"){console[t]("----------------------------------"),console[t]("[FPM Media Cleaner]"),console[t](`${e}`),console[t]("----------------------------------")}(t.message,"error"),e}}))}function n(){return{status:document.querySelector("[data-options-status]"),lastUpdate:document.querySelector("[data-options-last-update]"),count:document.querySelector("[data-options-count]"),skipImages:document.querySelector("[data-options-skip-image]"),progress:document.querySelector("[data-fpm-media-progress]"),refreshBtn:document.querySelector("[data-fpm-media-cleaner-refresh]"),purgeBtn:document.querySelector("[data-fpm-media-cleaner-remove]"),activeCount:document.querySelector("[data-fpm-media-cleaner-count]")}}function r(e){const t=document.createElement("td");return"string"==typeof e?t.innerHTML=e:t.appendChild(e),t}function o(e){const t=document.createElement("img");return t.src=e,t}function a(){const e=n();t("media-clean-get-count",{}).done((function(t){e.activeCount.innerHTML=t.count;const n=Number.parseInt(e.count.innerHTML),r=Number.parseInt(t);Number.isNaN(n)||Number.isNaN(r)?(e.progress.removeAttribute("max"),e.progress.removeAttribute("value")):(e.progress.setAttribute("max",n),e.progress.setAttribute("value",n-r))})).fail((function(){console.error("error")}))}function i(){const r=n();t("media-clean-get-options",{}).done((function(t){for(const n of t)switch(n.option_key){case"status":r.status.innerHTML=n.option_value,n.option_value.startsWith("process")&&(r.progress.parentNode.classList.add("show"),r.refreshBtn.setAttribute("disabled",""),r.purgeBtn.setAttribute("disabled","")),n.option_value.startsWith("finish")&&(r.progress.parentNode.classList.remove("show"),r.refreshBtn.removeAttribute("disabled"),r.purgeBtn.removeAttribute("disabled"));break;case"last_update":const t=new Date(n.option_value);r.lastUpdate.innerHTML=e(t);break;case"count":r.count.innerHTML=n.option_value;break;case"skip_ids":let a=Array.from(r.skipImages.querySelectorAll("img"));if(0===a.length&&(r.skipImages.innerHTML=""),a=a.map((e=>e.src)),Array.isArray(n.option_value))for(const e of n.option_value)a.includes(e[0])||r.skipImages.appendChild(o(e[0]))}})).fail((function(){console.error("error")}))}function s(){const n=document.querySelector("[data-clean-media]");if(!n)return alert("Fehler");n.classList.add("is-loading"),t("media-clean-get-cache",{}).done((function(t){n.classList.remove("is-loading");const a=n.querySelector("tbody");if(a.innerHTML="",0===t.length){n.classList.remove("fill");const e=document.createElement("tr"),t=r("Keine Daten vorhanden.");t.setAttribute("colspan",n.querySelectorAll("th").length),e.appendChild(t),a.appendChild(e)}else{n.classList.add("fill");for(const n of t){const t=document.createElement("tr");t.appendChild(r(n.id)),t.appendChild(r(o(n.img[0])));const i=new Date(n.post_modified);t.appendChild(r(n.post_title));const s=r(e(i));s.setAttribute("colspan","2"),t.appendChild(s),a.appendChild(t)}}})).fail((function(){console.error("error")}))}$((function(){document.querySelector("[data-fpm-media-cleaner]")&&(setInterval(a,5e3),setInterval(i,5e3),a(),i(),s(),document.querySelector("[data-fpm-media-cleaner-refresh]").addEventListener("click",(function(){t("media-clean-fill-cache",{}).done((function(e){console.log("safty",e)})).fail((function(){console.error("error")})),setTimeout((()=>i()),500)})),document.querySelector("[data-fpm-media-cleaner-clear-skip]").addEventListener("click",(function(){t("media-clean-set-skip",{ids:!1}).done((function(e){n().skipImages.innerHTML="",i()}))})),document.querySelector("[data-fpm-media-cleaner-remove]").addEventListener("click",(function(){confirm("Möchtest du die Bilder löschen?")&&(t("media-clean-remove",{}).done((function(e){})).fail((function(){console.error("error")})),setTimeout((()=>i()),500))})),document.querySelector("[data-refresh-cash]").addEventListener("click",(function(){s()})),document.querySelector("[data-add-skip-images]").addEventListener("click",(function(){const e=wp.media({title:"Bilder die übersprungen werden auswählen",library:{type:"image"},multiple:!0,button:{text:"auswählen"}});e.on("select",(function(){t("media-clean-set-skip",{ids:e.state().get("selection").toJSON().map((e=>e.id))}).done((function(e){i()}))})),e.open()})))}))}(jQuery);