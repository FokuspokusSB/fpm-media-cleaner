!function($){"use strict";let e,t;function n(e,t="log"){console[t]("----------------------------------"),console[t]("[FPM Media Cleaner]"),console[t](`${e}`),console[t]("----------------------------------")}function r(e){let t,n,r,a,o;return t=e.getHours(),n=e.getMinutes(),r=e.getDate(),a=e.getMonth()+1,o=e.getFullYear(),t=t.toString().padStart(2,"0"),n=n.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),a=a.toString().padStart(2,"0"),`${t}:${n} ${r}.${a}.${o}`}function a(e,t){return $.post(ajaxurl,{action:e,...t}).pipe((function(e){try{return JSON.parse(e)}catch(t){return n(t.message,"error"),e}}))}function o(){return{status:e.querySelector("[data-options-status]"),lastUpdate:e.querySelector("[data-options-last-update]"),count:e.querySelector("[data-options-count]"),skipImages:e.querySelector("[data-options-skip-image]"),skipFilebirdFolder:e.querySelector("[data-options-skip-filebird-folder]"),progress:e.querySelector("[data-fpm-media-progress]"),refreshBtn:e.querySelector("[data-fpm-media-cleaner-refresh]"),purgeBtn:e.querySelector("[data-fpm-media-cleaner-remove]"),activeCount:e.querySelector("[data-fpm-media-cleaner-count]")}}function i(e){const t=document.createElement("td");return"string"==typeof e?t.innerHTML=e:t.appendChild(e),t}function s(e){const t=document.createElement("img");return t.src=e,t}function c(){const e=o();a("media-clean-get-count",{}).done((function(t){e.activeCount.innerHTML=t.count;const n=Number.parseInt(e.count.innerHTML),r=Number.parseInt(t);Number.isNaN(n)||Number.isNaN(r)?(e.progress.removeAttribute("max"),e.progress.removeAttribute("value")):(e.progress.setAttribute("max",n),e.progress.setAttribute("value",n-r))})).fail((function(){console.error("error")}))}function l(){const e=o();a("media-clean-get-options",{}).done((function(t){for(const n of t)switch(n.option_key){case"status":e.status.innerHTML=n.option_value,n.option_value.startsWith("process")&&(e.progress.parentNode.classList.add("show"),e.refreshBtn.setAttribute("disabled",""),e.purgeBtn.setAttribute("disabled","")),n.option_value.startsWith("finish")&&(e.progress.parentNode.classList.remove("show"),e.refreshBtn.removeAttribute("disabled"),e.purgeBtn.removeAttribute("disabled"));break;case"last_update":const t=new Date(n.option_value);e.lastUpdate.innerHTML=r(t);break;case"count":e.count.innerHTML=n.option_value;break;case"skip_ids":let a=Array.from(e.skipImages.querySelectorAll("img"));if(0===a.length&&(e.skipImages.innerHTML=""),a=a.map((e=>e.src)),Array.isArray(n.option_value))for(const t of n.option_value)a.includes(t[0])||e.skipImages.appendChild(s(t[0]))}})).fail((function(){console.error("error")}))}function d(){const n=e.querySelector("[data-clean-media]");if(!n)return alert("Fehler");n.classList.add("is-loading"),a("media-clean-get-cache",{}).done((function(e){n.classList.remove("is-loading");const a=n.querySelector("tbody");if(a.innerHTML="",0===e.length){n.classList.remove("fill");const e=document.createElement("tr"),r=i(t["No data available."]);r.setAttribute("colspan",n.querySelectorAll("th").length),e.appendChild(r),a.appendChild(e)}else{n.classList.add("fill");for(const t of e){const e=document.createElement("tr");e.appendChild(i(t.id)),e.appendChild(i(s(t.img[0])));const n=new Date(t.post_modified);e.appendChild(i(t.post_title));const o=i(r(n));o.setAttribute("colspan","2"),e.appendChild(o),a.appendChild(e)}}})).fail((function(){console.error("error")}))}function u(){var n;e.querySelector("[data-init-filebird]")&&((n=$('\n      <div class="m-fpm-media-cleaner">\n        <div class="dialog-content" data-content="">\n          <center>\n            <div class="loading"><div></div><div></div><div></div><div></div></div>\n          </center>\n        </div>\n      </div>\n      ')).dialog({title:t["Select Filebird Folder"],dialogClass:"wp-dialog wp-core-ui",draggable:!1,modal:!0,autoOpen:!1,closeOnEscape:!0,buttons:{Close:function(){$(this).dialog("close")}},open:function(e,t){a("media-clean-get-filebird-folders").done((function(e){!function(e,t){e.html(""),function e(t,n){const r=$('<ul class="jstree-container-ul jstree-children jstree-contextmenu"></ul>');t.append(r);for(const t of n){const n=$('<li \n              role="treeitem"\n              data-count="6"\n              data-parent="0"\n              real-count="6"\n              style="--color: #8f8f8f"\n              aria-selected="false"\n              aria-level="1"\n              aria-labelledby="1_anchor"\n              id="1"\n              class="jstree-node jstree-leaf ui-droppable"\n            ></li>');n.html(`${t.name}`),r.append(n),t.children&&e(n,t.children)}}(e,t)}(n,e)}))}}),e.querySelector("[data-select-filebird-folder]").addEventListener("click",(function(){n.dialog("open")})))}$((function(){e=document.querySelector("[data-fpm-media-cleaner]");try{t=JSON.parse(e.querySelector("[data-js-translations]").innerHTML)}catch(e){n(e.message,"error")}e&&(setInterval(c,5e3),setInterval(l,5e3),c(),l(),d(),u(),e.querySelector("[data-fpm-media-cleaner-refresh]").addEventListener("click",(function(){a("media-clean-fill-cache",{}).done((function(e){})).fail((function(){})),setTimeout((()=>l()),500)})),e.querySelector("[data-fpm-media-cleaner-clear-skip]").addEventListener("click",(function(){a("media-clean-set-skip",{ids:!1}).done((function(e){o().skipImages.innerHTML="",l()}))})),e.querySelector("[data-fpm-media-cleaner-remove]").addEventListener("click",(function(){confirm(t["Do you want to delete the pictures?"])&&(a("media-clean-remove",{}).done((function(e){})).fail((function(){console.error("error")})),setTimeout((()=>l()),500))})),e.querySelector("[data-refresh-cash]").addEventListener("click",(function(){d()})),e.querySelector("[data-add-skip-images]").addEventListener("click",(function(){const e=wp.media({title:t["Skip Images Select"],library:{type:"image"},multiple:!0,button:{text:t.select}});e.on("select",(function(){a("media-clean-set-skip",{ids:e.state().get("selection").toJSON().map((e=>e.id))}).done((function(e){l()}))})),e.open()})))}))}(jQuery);